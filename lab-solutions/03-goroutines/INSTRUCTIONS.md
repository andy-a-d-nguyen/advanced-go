# Language Review Lab

In this lab, you will be finishing the implementation of an asynchronous logging service. This service is intended to receiver HTTP messages and write the request body's content out the a log file. You have been provided with the API and partial implementation of many functions and methods. Your goal is to finish the logging service and discuss design decisions that you made.

## Complete alog package

### Implement the logWriter#Write method

The `logWriter#Write` method is used by the `log` package to determine how messages will actually be written. To prevent shared memory issues, this method will construct a message that will be sent into `logCh` channel. The `logCh` channel's receiver will handle the task of writing the actual log entry to the file. To finish the `logWriter#Write` method, the following steps are required:

* Construct a `msgWrapper` object and pass that into `logCh`
* Properly handle any errors that are generated by the `logCh` channel's receiver (Note: any errors will be sent through the `msgWrapper`'s channel)
* Return the results of the action to the caller for all success and failure paths

### Implement the writeToLog function

The `writeToLog` function has the responsibility of receiving logging requests (coming from `logWriter#Write` calls) and writing those messages to the log file. Finish implementing the `writeToLog` file by adding the following capabilities:

* Listen for messages coming in from the `logCh` for as log as that channel is open
* When a message arrives:
    * Open the destination file, whose path is specified by the package level `Destination` variable, for write access. This call should handle both the creation of a non-existent file as well as opening an existing one.
        * See the `os.OpenFile` function
    * Attempt to write the message to the file
    * Handle any errors that may arise
        * Generated errors shoul be returned to the originator fo the current message
* When all messages have been processed (e.g. the `logCh` cannot send new messages), send a message into `doneCh`. This will be used in the next step.

### Implement the logWriter#Close method

The `logWriter#Close` method is intended to gracefully close down the logger. Gracefully shutting down, in this case, means that all pending messages are written to the log file before the application exits.

* Determine a way to send a signal to the `writeToFile` function indicating that new messages will no longer be generated for it to process
* Wait for a signal that indicates the the `writeToFile` function has completed writing all pending messages to the log file

## Implement service handler

The `service` package is designed to handle all HTTP interactions with this service. 

* Examine the package's structure and be prepared to discuss the role of the `RegisterHandlers` function. ***What are the advantages and disadvantages of the approach used?***

### Prevent unsupported methods

* The service handler is intended to only handle POST requests. Add a guard to the `handleMessage` function that will send an appropriate status message if any other method is used.

### Implement the service behavior

* Read the contents of the request body
    * `io` has functions that can simplify this
* Write the request's body the the log
* Send appropriate responses to the requestor depending on the result of the request using the `ResponseWriter#WriteHeader` method


## Analyze main() function
* Review the main() function and be prepared to discuss its use of the following:
    * the flag package
    * contexts
